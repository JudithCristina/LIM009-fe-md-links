
function escape(html, encode) {
    return html
        .replace(!encode ? /&(?!#?\w+;)/g : /&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
}

module.exports = function(code, lang, escaped) {
    if(typeof lang == "string") {
        lang = lang.toLowerCase();
        switch (lang) {
            case "katex":
                lang = "math";
                break;
            case "music":
                lang = "abc";
                break;
            case "yml":
                lang = "yaml";
                break;
        }
    } else {
        lang = "txt";
    }

    lang = !escaped ? escape(lang, true) : lang;
    code = !escaped ? escape(code, true) : code;

    return '<pre class="lang lang-' + lang + '"><code class="lang-' + lang + '">' + code + '</code></pre>';
};